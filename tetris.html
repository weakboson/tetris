<!DOCTYPE html>
<html>
  <head>
    <title>tetris</title>
    <script type="text/javascript">
// <![CDATA[
var ctx;
var block = [
  [1,1],
  [0,1],
  [0,1]
];
var posx=0, posy=0;
var map,mapWidth=10,mapHeight=20;
var load = function()
{
  ctx = document.getElementById('target').getContext('2d');
  map = [];
  for(var y=0;y<mapHeight;y++){
    map[y] = [];
    for(var x=0;x<mapWidth;x++){
      map[y][x]=0;
    }
  }
  setInterval(paint,200);
};
var check = function(matrix, map, offsetx, offsety)
{
  if (offsetx<0 || offsety<0 || offsety+matrix.length>mapHeight || offsetx+matrix[0].length>mapWidth) {
    return false;
  }
  for (var y=0; y<matrix.length; y++){
    for(var x=0; x<matrix[y].length; x++){
      if (matrix[y][x] && map[y+offsety][x+offsetx]){
        return false;
      }
    }
  }
  return true;
};
var mergeMatrix = function(map,matrix,offsetx,offsety)
{
  for(var y=0; y<matrix.length; y++){
    for(var x=0; x<matrix[y].length; x++){
      if (matrix[y][x]){
        map[offsety+y][offsetx+x]=1;
      }
    }
  }
};
var paintMatrix = function(matrix,offsetx,offsety,color)
{
  ctx.fillStyle = color;
  for(var y=0; y<matrix.length; y++){
    for(var x=0; x<matrix[y].length; x++){
      if(matrix[y][x]===1){
        ctx.fillRect((offsetx+x)*20,(offsety+y)*20,20,20);
      }
    }
  }
};
var paint = function()
{
  ctx.clearRect(0,0,200,400);
  paintMatrix(map,0,0,'rgb(128,0,0)');
  paintMatrix(block,posx,posy,'rgb(255,0,0)');
  if (check(block,map,posx,posy+1)) {
    posy++;
  } else {
    mergeMatrix(map,block,posx,posy);
    posx=0,posy=0;
  }
};
// ]]>
    </script>
  </head>
  <body onload="load()">
    <canvas id="target" style="border:5px solid gray" width="200" height="400"></canvas>
  </body>
</html>
